<!DOCTYPE html>
<html>

<head>
	<meta charset="UTF-8">
	<title>安徽食品安全培训网</title>
	<link href="img/logo.png" rel="SHORTCUT ICON">
	<link rel="stylesheet" href="css/nprogress.css">
	<script type="text/javascript" src="js/nprogress.js"> </script>
	<link rel="stylesheet" href="layui/css/layui.css" />
	<link rel="stylesheet" href="css/swiper.min.css">
	<link rel="stylesheet" href="css/index.css" />
</head>

<body>
	<!-- 头部 -->
	<header>
		<div class="top">
			<section>
				<p>你好， 欢迎访问安徽食品安全培训网</p>
				<p>
					<a onclick="openUrl('login.html')" href="javascript:;">现在登录！</a>
				</p>
				<p><img src="img/user.png" />个人中心</p>
			</section>
			<nav>
				<h1 onclick="openUrl('index.html')">
					<img src="img/logo.png" />
					<p>安徽食品安全培训网</p>
					<i>Food safety training in anhui province </i>
				</h1>
				<ul id="navList">
					<li>首页<i></i></li>
					<li>课程中心<i></i></li>
					<li>学习指南<i></i></li>
					<li>教学公告<i></i></li>
					<li>食品安全资讯<i></i></li>
					<li>在线证书查询<i></i></li>
					<li>考试中心<i></i></li>
				</ul>
			</nav>
		</div>
	</header>
	<div class="courseCenter">
		<!-- 子页面轮播 -->
		<div class="swiper-container sonBanner">
			<div class="swiper-wrapper">
				
			</div>
		</div>
		<section class="centre">
			<h1 class="titleSon">
				<a href="index.html">首页</a>
				<a href="courseCenter.html">> 课程中心</a>
				<a href="">> 详情</a>
			</h1>
			<div class="courseDetalisTop">
				<!-- 模拟骨架屏 -->
				<div class="temporary">
					<div class="left gjpAfter"></div>
					<div class="right">
						<p class="temporaryList gjpAfter" style="width: 80%;margin-bottom: 12px;"></p>
						<p class="temporaryList gjpAfter" style="width: 50%;margin-bottom: 12px;"></p>
						<p class="temporaryList gjpAfter" style="width: 30%;margin-bottom: 78px;"></p>
						<p class="temporaryList gjpAfter" style="width: 40%;margin-bottom: 12px;"></p>
					</div>
				</div>
				<div id="viewCourse"></div>
				<script id="courseCenterDetailsTopTpl" type="text/html">
					{{#  if(d.fontCoverPic == 0){ }}
					<div class="left gjpAfter"></div>
					{{#  } else { }}
					<div class="left gjpAfter">
						<img src="{{d.fontCoverPic}}"/>
					</div>
					{{#  } }} 
					
					<div class="right">
							<h1>
								<em>{{d.courseName}}</em>
								{{#  if(d.compulsoryHours > 0){ }}
								<span>必修课程</span>
								{{#  } }} 
								{{#  if(d.favorite == false){ }}
								<b><i class="layui-icon layui-icon-rate-solid"></i><strong>收藏课程</strong></b>
								{{#  } else { }}
								<b class="collect"><i class="layui-icon layui-icon-rate-solid"></i><strong>已收藏</strong></b>
								{{#  } }} 
								
							</h1>
							<p>{{d.courseSummary}}</p>
							<div class="timeBox">
								<span>
									<img src="../img/book.png">
									<p>{{d.learnNum}}人学习</p>
								</span>
								<span>
									<img src="../img/time.png">
									<p>{{d.courseHourNum}}课时/{{d.totalLearningHours}}分钟</p>
								</span>
								<span>
									{{#  if(d.learnProgress == 'unstart'){ }}
									<p class="">还未开始学习</p>
									{{#  } else { }}
									<p class="orange">已经学习{{d.learnProgress}}课</p>
									{{#  } }} 
								</span>
							</div>
							<div class="priceBox">
								<h2>￥{{d.courseRealPrice}}</h2>
								<i>￥{{d.coursePrice}}</i>
								{{#  if(d.pricePublicize == 0){ }}
								{{#  } else { }}
								<span>优惠特价，{{d.pricePublicize}}</span>
								{{#  } }} 
							</div>
							
							{{#  if(d.buyStatus == 'unpurchased'){ }}
								<button onclick="openUrl('purchase.html?id={{d.id}}')" type="button" class="layui-btn">立刻购买 ></button>
							{{#  } else if(d.courseHourList.length == 0) { }}
								<button type="button" class="layui-btn layui-btn-disabled">暂无课程</button>
							{{#  } else { }}
								<button onclick="openUrl('watchVideo.html?id={{d.id}}&sid={{d.courseHourList[0].id}}')" type="button" class="layui-btn">继续学习 ></button>
							{{#  } }} 
					</div>
				</script>
			</div>
		</section>
		<div class="courseDetalisTab">
			<div class="centre">
				<div class="layui-tab layui-tab-brief" lay-filter="docDemoTabBrief">
					<ul class="layui-tab-title">
						<li class="layui-this">课程简介</li>
						<li>课程目录</li>
						<li class="questionBank">课程题库</li>
					</ul>
					<div class="layui-tab-content">
						<div class="layui-tab-item layui-show trainingDetail">

						</div>
						<div class="layui-tab-item">
							<ul id="kcList">
								
							</ul>
						</div>
						<div class="layui-tab-item qrCodeBox">
							<div class="left gjpAfter">
								<p>小程序正在努力开发中</p>
								<P class="toExercise">前往线上题库进行练习>></P>
								<!-- <img src="img/code.png" /> -->
							</div>
							<div class="right">
								<h1 class="courseName"></h1>
								<span>专项练习</span>
								<span>海量题库</span>
								<span>紧贴考点</span>
								<p>海量题库，贴合课程 <br>前往小程序进行刷题</p>
								<h2>扫描二维码，识别小程序</h2>
							</div>
							<button class="toExercise">前往线上题库进行练习</button>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
	<footer></footer>
	
	<script type="text/javascript" src="js/jquery-3.4.1.min.js"></script>
	<script type="text/javascript" src="layui/layui.all.js"></script>
	<script type="text/javascript" src="js/swiper.min.js"> </script>
	<script type="text/javascript" src="js/main.js"></script>
	<script>

		$(".topList span").click(function () {
			$(this).addClass("active").siblings().removeClass("active");
		});
		//课程详情
		courseDetail();
		function courseDetail() {
			layui.use(['laypage', 'layer', 'laytpl'], function () {
				var laypage = layui.laypage,
					laytpl = layui.laytpl,
					layer = layui.layer;
				http.ajax({
					url: 'course/courseDetail',
					type: 'GET',
					json: false,
					mask: false,
					data: {
						courseId: getQueryString("id")
					}
				}).then(function (data) {
					if (data.code == 200) {
						$(".temporary").hide();
						// 数据渲染
						var data = beZero(data.data);
						if(data.buyStatus == 'unpurchased'){
							$(".questionBank").hide();
						}
						var totalList = data.total;
						var getTpl = courseCenterDetailsTopTpl.innerHTML,
							view = document.getElementById('viewCourse');
						laytpl(getTpl).render(data, function (html) {
							view.innerHTML = html;
						});
						$(".trainingDetail").html(data.trainingDetail);
						$(".courseName").html(data.courseName + ' 专项刷题');
						$("title").html(data.courseName);
						
						var listHtml = ""
						for (var i = 0; i < data.courseHourList.length; i++) {
							if(data.courseHourList[i].learnStatus == 'completed'){
								listHtml += '<li class="active" id="'+data.courseHourList[i].id+'">';
							}else{
								listHtml += '<li id="'+data.courseHourList[i].id+'">';
							}
							listHtml += '<img src="img/video.png" />';
							listHtml += '<p>'+(i+1)+' - '+data.courseHourList[i].courseHourName+'</p>';
							if(data.courseHourList[i].learnStatus == 'completed'){
								listHtml += '<time><img src="img/vtime.png" />已学习</time>';
							}else{
								listHtml += '<time><img src="img/vtime.png" />'+data.courseHourList[i].courseResourceDuration+'分钟</time>';
							}
							listHtml += '<input type="hidden" value="'+data.courseHourList[i].free+'" class="free" />';
							listHtml += '</li>';
						};

						if(data.courseHourList.length == 0){
							listHtml +='<li><img src="img/video.png" /><p>暂无课程列表</p></li>'
						}

						$("#kcList").append(listHtml);

						$("#kcList li").click(function () {
							localStorage.removeItem("courseHourId");
							var sid = $(this).attr("id");
							var free = $(this).find(".free").val();
							//是否购买，购买直接看，没购买，看是否免费
							if(sid && data.buyStatus == 'purchased'){
								openUrl('watchVideo.html?id='+getQueryString("id")+'&sid='+sid+'');
							}else{
								if(sid && free == 'true'){
									openUrl('watchVideo.html?id='+getQueryString("id")+'&sid='+sid+'');
								}else{
									layer.msg('未购买不可观看！', {
										icon: 5
									}, function () {
									});
								}
							}
							
						});
						//收藏
						$(".courseDetalisTop .right h1 b").click(function () {
							if (data.favorite == false) {
								favorite(getQueryString("id"))
							} else {
								cancelCollection(getQueryString("id"))
							}
						});

						$("button").click(function () {
							localStorage.removeItem("courseHourId");
						});
					}
				}, function (err) {
					if(err.status == 403){
						layer.msg('未登录，不可操作！', {
							icon: 5,
							time: 800, 
						},function(){
							location.href = 'login.html';
						});
					}
				})
			})
		};

		//去练习
		$(".toExercise").click(function () {
			openUrl('doExercise.html?id=' + getQueryString("id") + '')
		});

		//收藏接口
		function favorite(courseId) {
			http.ajax({
				url: 'course/favorite',
				type: 'GET',
				json: false,
				mask: false,
				data: {
					courseId: courseId
				}
			}).then(function (data) {
				if (data.code == 200) {
					layer.msg('收藏成功！');
					$(".courseDetalisTop .right h1 b").addClass("collect").find("strong").text("已收藏");
				}
			}, function (err) {

			})
		};
		//取消收藏
		function cancelCollection(courseId) {
			http.ajax({
				url: 'course/cancelCollection',
				type: 'GET',
				json: false,
				mask: false,
				data: {
					courseId: courseId
				}
			}).then(function (data) {
				if (data.code == 200) {
					layer.msg('取消收藏！');
					$(".courseDetalisTop .right h1 b").removeClass("collect").find("strong").text("收藏课程");
				}
			}, function (err) {

			})
		};

	</script>
</body>

</html>